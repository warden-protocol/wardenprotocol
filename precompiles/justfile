git_root := `git rev-parse --show-toplevel`
tmpdir := `mktemp -d`

all: abi

_tools:
  # Install solc if not present
  command -v solc || brew install solidity
  go install \
    github.com/ethereum/go-ethereum/cmd/abigen

abi: _tools
  # Generate Act contract artifacts
  solc --evm-version paris --abi {{git_root}}/precompiles/act/IAct.sol -o {{tmpdir}} --overwrite
  cat {{tmpdir}}/IAct.abi | jq '.' > {{git_root}}/precompiles/act/abi.json
  abigen --abi {{git_root}}/precompiles/act/abi.json --pkg act --type IAct --out {{git_root}}/precompiles/act/IAct.go
  cat {{tmpdir}}/IAct.abi | jq '. | {abi: .}' > {{git_root}}/precompiles/act/abi.json

  # Generate Warden contract artifacts
  solc --evm-version paris --abi {{git_root}}/precompiles/warden/IWarden.sol -o {{tmpdir}} --overwrite
  cat {{tmpdir}}/IWarden.abi | jq '.' > {{git_root}}/precompiles/warden/abi.json
  abigen --abi {{git_root}}/precompiles/warden/abi.json --pkg warden --type IWarden --out {{git_root}}/precompiles/warden/IWarden.go
  cat {{tmpdir}}/IWarden.abi | jq '. | {abi: .}' > {{git_root}}/precompiles/warden/abi.json

  # Generate Slinky contract artifacts
  solc --evm-version paris --abi {{git_root}}/precompiles/slinky/ISlinky.sol -o {{tmpdir}} --overwrite
  cat {{tmpdir}}/ISlinky.abi | jq '.' > {{git_root}}/precompiles/slinky/abi.json
  abigen --abi {{git_root}}/precompiles/slinky/abi.json --pkg slinky --type ISlinky --out {{git_root}}/precompiles/slinky/ISlinky.go
  cat {{tmpdir}}/ISlinky.abi | jq '. | {abi: .}' > {{git_root}}/precompiles/slinky/abi.json