git_root := `git rev-parse --show-toplevel`
tmpdir := `mktemp -d`

all: pricepred stoicquote

_tools:
    @command -v solc >/dev/null 2>&1 || (echo "solc not found. Please install solc. On MacOS, you can use 'brew install solidity'." && exit 1)
    go install github.com/ethereum/go-ethereum/cmd/abigen

pricepred: _tools
  solc --abi --bin --overwrite handlers/pricepred/PricePredictorTypes.sol -o build
  mkdir handlers/pricepred/generated
  abigen \
  --bin=build/PricePredictorTypes.bin \
  --abi=build/PricePredictorTypes.abi \
  --pkg=generated \
  --type=PricePredictorTypes \
  --out=handlers/pricepred/generated/pricepred_bindings.go

stoicquote: _tools
  go run ../soliditygen/cmd/cmd.go --url="https://stoic.tekloon.net/stoic-quote" --contractName="StoicQuote" --contractDir=handlers/stoicquote/generated
  solc --abi --bin --overwrite handlers/stoicquote/generated/StoicQuoteTypes.sol -o build
  abigen \
  --bin=build/StoicQuoteTypes.bin \
  --abi=build/StoicQuoteTypes.abi \
  --pkg=generated \
  --type=StoicQuoteTypes \
  --out=handlers/stoicquote/generated/stoicquote_bindings.go